{% extends "base.html" %}
{% load package_extras %}
{% block title %}Arch Linux - Package Search{% endblock %}
{% block head %}
<script type="text/javascript" src="/media/admin_media/js/core.js"></script>
{{search_form.media}}
<script type="text/javascript" src="/jsi18n/"></script>
{% endblock %}

{% block content %}
    <div class="greybox">
        <h4 style="text-align: right">Search Criteria</h4>
        <form method="get" action="/packages/">
            <input type="hidden" name="sort" value='{{sort}}' />
            <table width="100%">
                <tr>
                    <td><span class="smalltext">Arch</span></td>
                    <td><span class="smalltext">Repository</span></td>
                    <td><span class="smalltext">Keywords</span></td>
                    <td><span class="smalltext">Maintainer</span></td>
                    <td><span class="smalltext">Last Update</span></td>
                    <td><span class="smalltext">Flagged</span></td>
                    <td><span class="smalltext">Per Page</span></td>
                </tr>
                <tr>
                    {% td_input search_form.arch %}
                    {% td_input search_form.repo %}
                    {% td_input search_form.q %}
                    {% td_input search_form.maintainer%}
                    {% td_input search_form.last_update %}
                    {% td_input search_form.flagged %}
                    {% td_input search_form.limit %}
                    <td><input type="submit" value="Search" /></td>
                </tr>
            </table>
        </form>
    </div>
    <br /><br />

    {% if package_list %}
    <div class="greybox">
        <form method="post" action="/packages/update/">
        <table class="results" width="100%">
            {% if paginator %}
                <tr>
                    <td colspan="{% if user.is_authenticated %}6{% else %}5{% endif %}">
                        {{paginator.count}} packages found.
                        Page {{page_obj.number}} of {{paginator.num_pages}}.
                    </td>
                    <td>
                        {% if page_obj.has_previous %}
                        <a href="/packages/{{page_obj.previous_page_number}}/{{current_query}}">
                            &lt;&lt;&lt; Previous
                        </a>
                        {% else %}
                            &lt;&lt;&lt; Previous
                        {% endif %}
                    </td>
                    <td>
                        {% if page_obj.has_next %}
                        <a href="/packages/{{page_obj.next_page_number}}/{{current_query}}">
                            Next &gt;&gt;&gt;
                        </a>
                        {% else %} 
                            Next &gt;&gt;&gt;
                        {% endif %}
                    </td>
                </tr>
            {% endif %}
            <tr>
                {% if user.is_authenticated %}
                <th>&nbsp;</th>
                {% endif %}
                <th><a href="/packages/{% buildsortqs "arch" %}">Arch</a></th>
                <th><a href="/packages/{% buildsortqs "repo" %}">Repo</a></th>
                <th><a href="/packages/{% buildsortqs "pkgname" %}">Name</a></th>
                <th>Version</th>
                <th>Description</th>
                <th><a href="/packages/{% buildsortqs "maintainer" %}">Maintainer</a></th>
                <th><a href="/packages/{% buildsortqs "-last_update" %}">Last Updated</a></th>

            </tr>
            {% for pkg in package_list %}
                <tr class="{% cycle pkgr2,pkgr1 %}">
                    {% if user.is_authenticated %}
                    <td><input type="checkbox" name="pkgid" value="{{ pkg.id }}" /></td>
                    {% endif %}
                    <td>{{ pkg.arch.name }}</td>
                    <td>{{ pkg.repo.name|capfirst }}</td>
                    <td><a href="{{ pkg.get_absolute_url }}">{{ pkg.pkgname }}</a></td>
                {% if pkg.needupdate %}
                    <td><span style="color:red">{{ pkg.pkgver }}-{{ pkg.pkgrel }}</span></td>
                {% else %}
                    <td>{{ pkg.pkgver }}-{{ pkg.pkgrel }}</td>
                {% endif %}
                    <td>{{ pkg.pkgdesc }}</td>
                    <td>{{ pkg.maintainer|default:"Orphan" }}</td>
                    <td>{{ pkg.last_update|date:"Y-m-d" }}</td>
                </tr>
            {% endfor %}
            {% if paginator %}
                <tr>
                    <td colspan="{% if user.is_authenticated %}6{% else %}5{% endif %}">
                        {{paginator.count}} packages found.
                        Page {{page_obj.number}} of {{paginator.num_pages}}.
                    </td>
                    <td>
                        {% if page_obj.has_previous %}
                        <a href="/packages/{{page_obj.previous_page_number}}/{{current_query}}">
                            &lt;&lt;&lt; Previous
                        </a>
                        {% else %}
                            &lt;&lt;&lt; Previous
                        {% endif %}
                    </td>
                    <td>
                        {% if page_obj.has_next %}
                        <a href="/packages/{{page_obj.next_page_number}}/{{current_query}}">
                            Next &gt;&gt;&gt;
                        </a>
                        {% else %} 
                            Next &gt;&gt;&gt;
                        {% endif %}
                    </td>
                </tr>
            {% endif %}
        </table>
        {% if user.is_authenticated %}
        <div id="adoptbox">
            <input type="submit" name="adopt" value="Adopt Packages">
            <input type="submit" name="disown" value="Disown Packages">
        </div>
        {% endif %}
        </form>
    </div>
    {% endif %}
{% endblock %}

