{% extends "base.html" %}
{% load package_extras %}
{% block title %}Arch Linux - Package Search{% endblock %}
{% block head %}
<script type="text/javascript" src="/admin/jsi18n/"></script>
<script type="text/javascript" src="/media/admin_media/js/core.js"></script>
{{search_form.media}}
{% endblock %}

{% block content %}
    <div class="greybox">
        <h4 style="text-align: right">Search Criteria</h4>
        <form method="get" action="/packages/search/">
            <table width="100%">
                <tr>
                    <td><span class="smalltext">Arch</span></td>
                    <td><span class="smalltext">Repository</span></td>
                    <td><span class="smalltext">Keywords</span></td>
                    <td><span class="smalltext">Maintainer</span></td>
                    <td><span class="smalltext">Last Update</span></td>
                    <td><span class="smalltext">Flagged</span></td>
                    <td><span class="smalltext">Per Page</span></td>
                </tr>
                <tr>
                    {% td_input search_form.arch %}
                    {% td_input search_form.repo %}
                    {% td_input search_form.q %}
                    {% td_input search_form.maintainer%}
                    {% td_input search_form.last_update %}
                    {% td_input search_form.flagged %}
                    {% td_input search_form.limit %}
                    <td><input type="submit" value="Search" />
                </tr>
            </table>
        </form>
    </div>
    <br /><br />

    {% if package_list %}
    <div class="greybox">
        <table class="results" width="100%">
            <tr>
                <form method="post" action="/packages/update/">
                <th>&nbsp;</th>
                <th><a href="/packages/search/{% buildsortqs "arch" %}">Arch</a></th>
                <th><a href="/packages/search/{% buildsortqs "repo" %}">Repo</a></th>
                <th><a href="/packages/search/{% buildsortqs "pkgname" %}">Name</a></th>
                <th>Version</th>
                <th>Description</th>
                <th><a href="/packages/search/{% buildsortqs "maintainer" %}">Maintainer</a></th>
                <th><a href="/packages/search/{% buildsortqs "-last_update" %}">Last Updated</a></th>

            </tr>
            {% for pkg in package_list %}
                <tr class="{% cycle pkgr2,pkgr1 %}">
                    <td><input type="checkbox" name="pkgid" value="{{ pkg.id }}" /></td>
                    <td>{{ pkg.arch.name }}</td>
                    <td>{{ pkg.repo.name|capfirst }}</td>
                    <td><a href="{{ pkg.get_absolute_url }}">{{ pkg.pkgname }}</a></td>
                {% if pkg.needupdate %}
                    <td><span style="color:red">{{ pkg.pkgver }}-{{ pkg.pkgrel }}</span></td>
                {% else %}
                    <td>{{ pkg.pkgver }}-{{ pkg.pkgrel }}</td>
                {% endif %}
                    <td>{{ pkg.pkgdesc }}</td>
                    <td>{{ pkg.maintainer|default:"Orphan" }}</td>
                    <td>{{ pkg.last_update|date:"Y-m-d" }}</td>
                </tr>
            {% endfor %}
            {% if paginator %}
                <tr>
                    <td colspan="6">
                        {{paginator.count}} packages found.
                        Page {{page_obj.number}} of {{paginator.num_pages}}.
                    </td>
                    <td>
                        {% if page_obj.has_previous %}
                        <a href="/packages/search/{{page_obj.previous_page_number}}/{{current_query}}">
                            &lt;&lt;&lt; Previous
                        </a>
                        {% else %}
                            &lt;&lt;&lt; Previous
                        {% endif %}
                    </td>
                    <td>
                        {% if page_obj.has_next %}
                        <a href="/packages/search/{{page_obj.next_page_number}}/{{current_query}}">
                            Next &gt;&gt;&gt;
                        </a>
                        {% else %} 
                            Next &gt;&gt;&gt;
                        {% endif %}
                    </td>
                <br />
                </tr>
            {% endif %}
            <tr>
                <td colspan="3">&nbsp;</td>
                <td colspan="2" style="text-align:center"><input type="submit" name="adopt" value="Adopt Packages"></td>
                <td colspan="1" style="text-align:center"><input type="submit" name="disown" value="Disown Packages"></td>
                <td colspan="1">&nbsp;</td>
            </tr>
        </table>
    </div>
    {% endif %}
{% endblock %}

