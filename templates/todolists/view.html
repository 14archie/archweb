{% extends "base.html" %}
{% block title %}Arch Linux - Todo - {{ list.name }}{% endblock %}

{% block content %}
	<div class="greybox">
            <div style="float:right">
                {% if perms.main.delete_todolist %}
                    <a href="/todo/delete/{{list.id}}/">Delete Todo List</a> |
                {% endif %}
                {% if perms.main.change_todolist %}
                    <a href="/todo/edit/{{list.id}}/">Edit Todo List</a>
                {% endif %}
            </div>
		<h2 class="title">Todo List: {{ list.name }}</h2>
		<table id="todotable" class="results" width="100%">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Arch</th>
                    <th>Repo</th>
                    <th>Maintainer</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
            {% for pkg in list.packages %}
                <tr class="{% cycle pkgr2,pkgr1 %}">
                    <td><a href="{{ pkg.pkg.get_absolute_url }}">{{ pkg.pkg.pkgname }}</a></td>
                    <td>{{ pkg.pkg.arch.name }}</td>
                    <td>{{ pkg.pkg.repo.name|capfirst }}</td>
                    <td>{{ pkg.pkg.maintainer.get_full_name|default:"Orphan" }}</td>
                    <td>
                    {% if pkg.complete %}
                        <a href="/todo/flag/{{ list.id }}/{{ pkg.id }}/"><span style="color:blue">Complete</span></a>
                    {% else %}
                        <a href="/todo/flag/{{ list.id }}/{{ pkg.id }}/"><span style="color:red">Incomplete</span></a>
                    {% endif %}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
		</table>
        <br />
        <div class="box">
            <h3>List Description</h3>
            {{list.description|linebreaks}}
        </div>
	</div>

    {% load cdn %}{% jquery %}
    <script type="text/javascript">
        $(function() {
            $('a[href*=todo/flag]').click(function() {
                var link = this;

                $.getJSON(link.href, function(data) {
                    if (data.complete) {
                        $(link).text('Complete').css('color', 'blue');
                    } else {
                        $(link).text('Incomplete').css('color', 'red');
                    }
                });

                return false;
            });
        });
    </script>
{% endblock %}
